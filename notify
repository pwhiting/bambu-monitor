#!/bin/bash
# Send notification via ntfy.sh
# Takes topic as first argument, followed by optional message words.
# If no message provided, defaults to "check your print"

log() {
    echo "$0: $1" >&2
}

# Check if topic is provided
if [ $# -lt 1 ]; then
    log "Error: Topic required as first argument"
    log "Usage: notify <topic> [message words...]"
    exit 1
fi

# Get topic from first argument
TOPIC="$1"
shift

# Get message from remaining arguments, or use default
if [ $# -gt 0 ]; then
    MESSAGE="$*"
else
    MESSAGE="check your print"
fi

log "Sending notification to topic: $TOPIC"
log "Message: $MESSAGE"

# Send notification via ntfy.sh
if curl -s -d "$MESSAGE" "ntfy.sh/$TOPIC" > /dev/null 2>&1; then
    log "Notification sent successfully"
    exit 0
else
    log "Notification failed"
    exit 1
fi
